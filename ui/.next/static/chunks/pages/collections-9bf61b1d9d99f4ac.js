(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[583],{14785:(e,t,l)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/collections",function(){return l(89986)}])},21156:(e,t,l)=>{"use strict";l.d(t,{A:()=>r});var n=l(37876);let r=function(e,t){return Object.keys(t).forEach(l=>{Object.assign(e,{[l]:t[l]})}),e}(e=>{let{children:t}=e;return(0,n.jsx)("div",{className:"flex flex-col",children:(0,n.jsx)("div",{className:"-mx-4 my-2 overflow-x-auto md:mx-0 lg:mx-0",children:(0,n.jsx)("div",{className:"inline-block min-w-full py-2 align-middle",children:(0,n.jsx)("div",{className:"overflow-hidden rounded-lg shadow md:mx-0 lg:mx-0",children:(0,n.jsx)("table",{className:"min-w-full",children:t})})})})})},{TH:e=>{let{children:t,className:l,...r}=e,a=["px-4 py-3 bg-zinc-800 text-left text-xs leading-4 font-bold text-zinc-400 uppercase tracking-wider truncate"];return l&&a.push(l),(0,n.jsx)("th",{className:a.join(" "),...r,children:t})},TBody:e=>{let{children:t}=e;return(0,n.jsx)("tbody",{className:"divide-y divide-zinc-500 bg-zinc-700",children:t})},TD:e=>{let{children:t,alignText:l="left",noPadding:r,className:a,...s}=e,c=["text-sm font-semibold leading-5 text-white"];switch(l){case"left":c.push("text-left");break;case"center":c.push("text-center");break;case"right":c.push("text-right")}return r||c.push("px-4 py-4"),a&&c.push(a),(0,n.jsx)("td",{className:c.join(" "),...s,children:t})}})},57047:(e,t,l)=>{"use strict";l.d(t,{A:()=>s});var n=l(37876),r=l(48230),a=l.n(r);let s=l(14232).forwardRef((e,t)=>{let{badgeType:l="default",className:r,href:s,children:c}=e,i=["px-2 inline-flex text-xs leading-5 font-semibold rounded-full whitespace-nowrap"];switch(s?i.push("transition cursor-pointer !no-underline"):i.push("cursor-default"),l){case"danger":i.push("bg-red-600 bg-opacity-80 border-red-500 border !text-red-100"),s&&i.push("hover:bg-red-500 bg-opacity-100");break;case"warning":i.push("bg-yellow-500 bg-opacity-80 border-yellow-500 border !text-yellow-100"),s&&i.push("hover:bg-yellow-500 hover:bg-opacity-100");break;case"success":i.push("bg-green-500 bg-opacity-80 border border-green-500 !text-green-100"),s&&i.push("hover:bg-green-500 hover:bg-opacity-100");break;case"dark":i.push("bg-gray-900 !text-gray-400"),s&&i.push("hover:bg-gray-800");break;case"light":i.push("bg-gray-700 !text-gray-300"),s&&i.push("hover:bg-gray-600");break;default:i.push("bg-indigo-500 bg-opacity-80 border border-indigo-500 !text-indigo-100"),s&&i.push("hover:bg-indigo-500 hover:bg-opacity-100")}return(r&&i.push(r),null==s?void 0:s.includes("://"))?(0,n.jsx)("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:i.join(" "),ref:t,children:c}):s?(0,n.jsx)(a(),{href:s,children:(0,n.jsx)("a",{className:i.join(" "),ref:t,children:c})}):(0,n.jsx)("span",{className:i.join(" "),ref:t,children:c})})},89986:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>Q});var n=l(37876),r=l(48711),a=l(14232),s=l(89848),c=l(91104),i=l(41568),o=l(10291),d=l(77834),u=l(82851),m=l.n(u),x=l(89099),h=l.n(x);let f=e=>{let t=(e.disabled?"pointer-events-none touch-none ":"cursor-pointer ")+"px-1 py-4 ml-8 text-md font-semibold leading-5 transition duration-300 leading-5 whitespace-nowrap first:ml-0";return(0,n.jsx)("a",{onClick:()=>e.onClick(e.route),className:"".concat(t," ").concat(e.currentRoute.match(e.route)?" border-b text-amber-500 border-amber-600":"border-transparent text-zinc-500 hover:border-b focus:border-b hover:text-zinc-300 hover:border-zinc-400 focus:text-zinc-300 focus:border-zinc-400"),"aria-current":"page",children:e.children})},p=e=>(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:"hide-scrollbar overflow-x-scroll border-b border-zinc-600",children:(0,n.jsx)("nav",{className:"flex",children:e.routes.map((t,l)=>{var r;return(0,n.jsx)(f,{onClick:t=>e.onChange(t),route:t.route,disabled:!e.allEnabled,currentRoute:e.currentRoute?e.currentRoute:null==(r=e.routes[0])?void 0:r.route,children:t.text},"standard-settings-link-".concat(l))})})})});var b=l(27046),g=l(59307),j=l(71817),v=l(40681),y=l(97309),w=l(9542),N=l(16256),S=l(10850),E=l(23016);let A=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,[l,n]=(0,a.useState)(e),[r,s]=(0,a.useState)(e);return(0,a.useEffect)(()=>{let e=setTimeout(()=>{s(l)},t);return()=>{clearTimeout(e)}},[l,t]),[l,r,n]};var C=l(36572),T=l(57047),R=l(11684),k=l(21156),I=function(e){return e[e.COLLECTION=0]="COLLECTION",e[e.MEDIA=1]="MEDIA",e[e.RULES=2]="RULES",e}({});let D=e=>{let[t,l]=(0,a.useState)([]),[r,s]=(0,a.useState)(0),c=(0,a.useRef)(0),[d,u]=(0,a.useState)(999),x=(0,a.useRef)(999),h=(0,a.useRef)([]),f=(0,a.useRef)(!0),p=(0,a.useRef)(!1),[b,S,E]=A(""),[C,R]=(0,a.useState)("DESC"),[D,z]=(0,a.useState)(-1),[L,M]=(0,a.useState)();(0,a.useEffect)(()=>(s(1),()=>{l([]),h.current=[],x.current=999,c.current=0}),[]),(0,a.useEffect)(()=>{F(),setTimeout(()=>{s(1)},500)},[S,C,D]),(0,a.useEffect)(()=>{0!==r&&(c.current=c.current+1,_())},[r]);let H=()=>{!(window.innerHeight+document.documentElement.scrollTop>=.9*document.documentElement.scrollHeight)||f.current||p.current||25*(c.current-1)>=x.current||s(c.current+1)};(0,a.useEffect)(()=>{let e=m().debounce(H,200);return window.addEventListener("scroll",e),()=>{window.removeEventListener("scroll",e),e.cancel()}},[]);let _=async()=>{f.current||(p.current=!0);let t=await (0,i.Ay)("/collections/logs/".concat(e.collection.id,"/content/").concat(c.current,"?size=").concat(25).concat(S?"&search=".concat(S):"").concat(C?"&sort=".concat(C):"").concat(-1!==D?"&filter=".concat(D):""));u(t.totalSize),l([...h.current,...t.items]),f.current=!1,p.current=!1};(0,a.useEffect)(()=>{h.current=t,f.current||p.current||!(window.innerHeight+document.documentElement.scrollTop>=.9*document.documentElement.scrollHeight)||25*(c.current-1)>=x.current||s(r+1)},[t]),(0,a.useEffect)(()=>{x.current=d},[d]);let F=()=>{f.current=!0,p.current=!1,c.current=0,s(0),x.current=999,u(999),h.current=[],l([])};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"w-full",children:[(0,n.jsxs)("ul",{className:"collection-info",children:[(0,n.jsxs)("li",{children:[(0,n.jsx)("span",{children:"Date Added"}),(0,n.jsx)("p",{className:"collection-info-item",children:e.collection.addDate?new Date(e.collection.addDate).toLocaleDateString():"-"})]},"collection-info-added"),(0,n.jsxs)("li",{children:[(0,n.jsx)("span",{children:"Handled media items"}),(0,n.jsx)("p",{className:"collection-info-item",children:e.collection.handledMediaAmount})]},"collection-info-handled"),(0,n.jsxs)("li",{children:[(0,n.jsx)("span",{children:"Last duration"}),(0,n.jsx)("p",{className:"collection-info-item",children:e.collection.lastDurationInSeconds?(e=>{let t=[];for(let l of[{label:"year",seconds:31536e3},{label:"month",seconds:2592e3},{label:"day",seconds:86400},{label:"hour",seconds:3600},{label:"minute",seconds:60},{label:"second",seconds:1}]){let n=Math.floor(e/l.seconds);n>0&&(t.push("".concat(n," ").concat(l.label).concat(1!==n?"s":"")),e-=n*l.seconds)}return t.length>0?t.join(", "):"0 seconds"})(e.collection.lastDurationInSeconds):"-"})]},"collection-info-duration")]}),(0,n.jsx)("div",{className:"heading mt-5 font-bold text-zinc-300",children:(0,n.jsx)("h2",{children:"Logs"})}),(0,n.jsxs)("div",{className:"w-full pl-2 pr-2",children:[(0,n.jsxs)("div",{className:"mb-2 flex flex-grow flex-col sm:flex-grow-0 sm:flex-row sm:justify-end",children:[(0,n.jsxs)("div",{className:"mr-2 mt-4 flex w-full flex-grow sm:w-1/2",children:[(0,n.jsx)("span",{className:"inline-flex cursor-default items-center rounded-l-md border border-r-0 border-gray-500 bg-zinc-800 px-3 text-sm text-gray-100",children:(0,n.jsx)(g.A,{className:"h-6 w-6"})}),(0,n.jsx)("input",{type:"text",className:"rounded-r-only",value:b,onChange:e=>E(e.target.value)})]}),(0,n.jsxs)("div",{className:"mb-2 flex flex-1 flex-row justify-between sm:mb-0 sm:flex-none",children:[(0,n.jsxs)("div",{className:"mr-2 mt-4 flex flex-grow sm:w-1/2",children:[(0,n.jsx)("span",{className:"inline-flex cursor-default items-center rounded-l-md border border-r-0 border-gray-500 bg-zinc-800 px-3 text-sm text-gray-100",children:"DESC"===C?(0,n.jsx)(j.A,{className:"h-6 w-6"}):(0,n.jsx)(v.A,{className:"h-6 w-6"})}),(0,n.jsxs)("select",{id:"sort",name:"sort",onChange:e=>{R(e.target.value)},value:C,className:"rounded-r-only",children:[(0,n.jsx)("option",{value:"DESC",children:"Descending"}),(0,n.jsx)("option",{value:"ASC",children:"Ascending"})]})]}),(0,n.jsxs)("div",{className:"mt-4 flex flex-grow sm:w-1/2",children:[(0,n.jsx)("span",{className:"inline-flex cursor-default items-center rounded-l-md border border-r-0 border-gray-500 bg-zinc-800 px-3 text-sm text-gray-100",children:(0,n.jsx)(y.A,{className:"h-6 w-6"})}),(0,n.jsxs)("select",{id:"filter",name:"filter",onChange:e=>{z(+e.target.value)},value:D,className:"rounded-r-only",children:[(0,n.jsx)("option",{value:-1,children:"-"},"filter-option-all"),Object.values(I).filter(e=>"number"==typeof e).map((e,t)=>(0,n.jsx)("option",{value:+e,children:I[+e].charAt(0).toUpperCase()+I[+e].slice(1).toLowerCase()},"filter-option-".concat(t)))]})]})]})]}),(0,n.jsxs)(k.A,{children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)(k.A.TH,{children:"DATE"}),(0,n.jsx)(k.A.TH,{children:"LABEL"}),(0,n.jsx)(k.A.TH,{children:"EVENT"}),(0,n.jsx)(k.A.TH,{})]})}),(0,n.jsx)(k.A.TBody,{children:f.current?(0,n.jsx)("tr",{children:(0,n.jsx)(k.A.TD,{colSpan:4,noPadding:!0,children:(0,n.jsx)(o.A,{})})}):(0,n.jsxs)(n.Fragment,{children:[t.map((e,t)=>(0,n.jsxs)("tr",{children:[(0,n.jsx)(k.A.TD,{className:"text-gray-300",children:new Date(e.timestamp).toLocaleString()}),(0,n.jsx)(k.A.TD,{className:"text-gray-300",children:(0,n.jsx)(T.A,{badgeType:0===e.type?"danger":1===e.type?"warning":2===e.type?"success":"default",children:I[e.type].toUpperCase()})}),(0,n.jsxs)(k.A.TD,{className:"text-gray-300",children:[e.message,e.meta&&1==e.type&&(0,n.jsxs)(n.Fragment,{children:[" ",["media_added_manually","media_removed_manually"].includes(e.meta.type)&&(0,n.jsx)("span",{className:"text-gray-400",children:"(manual)"})]})]}),(0,n.jsx)(k.A.TD,{className:"text-right",children:e.meta&&1==e.type&&(0,N.isMetaActionedByRule)(e.meta)&&(0,n.jsx)("button",{type:"button",className:"rounded bg-amber-600 px-2 py-1 text-white shadow-md hover:bg-amber-500",title:"View Metadata",onClick:()=>{(0,N.isMetaActionedByRule)(e.meta)&&M({meta:e.meta,title:e.message})},children:(0,n.jsx)(w.A,{className:"h-5 w-5"})})})]},"log-list-".concat(t))),p.current?(0,n.jsx)("tr",{children:(0,n.jsx)(k.A.TD,{colSpan:2,noPadding:!0,children:(0,n.jsx)(o.r,{className:"m-auto mb-2 mt-2 w-8"})})}):void 0]})})]})]})]}),L?(0,n.jsx)(O,{onClose:()=>M(void 0),...L}):void 0]})},O=e=>{let t=(0,a.useRef)(void 0);return(0,n.jsx)("div",{className:"h-full w-full",children:(0,n.jsx)(R.A,{loading:!1,backgroundClickable:!1,onOk:e.onClose,okText:"Close",okButtonType:"primary",title:"Metadata",children:(0,n.jsxs)("div",{className:"h-[80vh] overflow-hidden",children:[(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)(C.A,{type:"info",children:"Below are the rule evaluation results that triggered this action. The output follows the same format as Test Media. Refer to the documentation for guidance on interpreting this output."})}),(0,n.jsx)("label",{htmlFor:"editor-field",className:"text-label mb-3",children:"Output"}),(0,n.jsx)("div",{className:"editor-container h-full",children:(0,n.jsx)(S.KE,{options:{readOnly:!0,minimap:{enabled:!1}},defaultLanguage:"yaml",theme:"vs-dark",value:E.Ay.stringify(e.meta.data),onMount:function(e,l){t.current=e}})})]})})})},z=e=>{let[t,l]=(0,a.useState)([]),r=(0,a.useRef)(0),[s,c]=(0,a.useState)(999),o=(0,a.useRef)(999),d=(0,a.useRef)([]),u=(0,a.useRef)(!0),x=(0,a.useRef)(!1),[h,f]=(0,a.useState)(0);(0,a.useEffect)(()=>{f(1)},[]);let p=()=>{!(window.innerHeight+document.documentElement.scrollTop>=.9*document.documentElement.scrollHeight)||u.current||x.current||25*(r.current-1)>=o.current||f(r.current+1)};(0,a.useEffect)(()=>{0!==h&&(r.current=r.current+1,g())},[h]),(0,a.useEffect)(()=>{let e=m().debounce(p,200);return window.addEventListener("scroll",e),()=>{window.removeEventListener("scroll",e),e.cancel()}},[]);let g=async()=>{u.current||(x.current=!0);let t=await (0,i.Ay)("/collections/exclusions/".concat(e.collection.id,"/content/").concat(r.current,"?size=").concat(25));c(t.totalSize),l([...d.current,...t.items.map(e=>(e.plexData.maintainerrExclusionId=e.id,e.plexData.maintainerrExclusionType=e.ruleGroupId?"specific":"global",e.plexData?e.plexData:{}))]),u.current=!1,x.current=!1};return(0,a.useEffect)(()=>{d.current=t,u.current||x.current||!(window.innerHeight+document.documentElement.scrollTop>=.9*document.documentElement.scrollHeight)||25*(r.current-1)>=o.current||f(h+1)},[t]),(0,a.useEffect)(()=>{o.current=s},[s]),(0,n.jsx)(b.A,{dataFinished:!0,fetchData:()=>{},loading:u.current,data:t,libraryId:e.libraryId,collectionPage:!0,collectionId:e.collection.id,extrasLoading:x&&!u.current&&s>=25*r.current,onRemove:e=>setTimeout(()=>{l(d.current.filter(t=>+t.ratingKey!=+e))},500)})};var L=l(90525),M=l(94035),H=l(83247),_=l(86073);let F=e=>{let t=async t=>(await (0,i.Ay)("/plex/library/".concat(e.libraryId,"/content/search/").concat(t,"?type=").concat(e.mediatype==M.R.MOVIES?M.R.MOVIES:M.R.SHOWS))).map(e=>({id:e.ratingKey,name:e.title,type:"movie"==e.type?M.R.MOVIES:M.R.SHOWS}));return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(_.A,{className:"react-select-container",classNamePrefix:"react-select",isClearable:!0,getOptionLabel:e=>e.name,getOptionValue:e=>e.id,defaultValue:[],defaultOptions:void 0,loadOptions:t,placeholder:"Start typing... ",onChange:t=>{e.onChange(t)}})})},P={id:-1,title:"-"},V=e=>{let[t,l]=(0,a.useState)(!0),[r,c]=(0,a.useState)(),[o,d]=(0,a.useState)(),[u,m]=(0,a.useState)(-1),[x,h]=(0,a.useState)(-1),[f,p]=(0,a.useState)([P]),[b,g]=(0,a.useState)([P]),[j,v]=(0,a.useState)(),y=(0,a.useRef)(void 0);(0,a.useEffect)(()=>{(0,i.Ay)("/rules/collection/".concat(e.collectionId)).then(e=>{c(e),l(!1)})},[]);let w=(0,a.useMemo)(()=>!!o&&!!r&&(r.dataType===M.R.MOVIES||r.dataType===M.R.SHOWS||r.dataType===M.R.SEASONS&&-1!==u||r.dataType===M.R.EPISODES&&-1!==u&&-1!==x||!1),[o,u,x]),N=e=>{m(e),h(-1),g([P]),-1!==e&&(0,i.Ay)("/plex/meta/".concat(e,"/children")).then(e=>{g([P,...e.map(e=>({id:e.ratingKey,title:"Episode ".concat(e.index)}))])})},A=async()=>{v(void 0),r&&v(await (0,i.vI)("/rules/test",{rulegroupId:r.id,mediaId:T}))},T=(0,a.useMemo)(()=>{if(o)return -1!==x?x:-1!==u?u:null==o?void 0:o.id},[u,x,o]);if((0,a.useEffect)(()=>{y.current&&(y.current.setValue(""),v(void 0))},[u,x,o]),t||!r)return;let k=async()=>{var e,t;let l=null==(t=y.current)||null==(e=t.getValue)?void 0:e.call(t);if(null==l?void 0:l.trim())try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(l);else throw Error("Clipboard not available");s.oR.success("Copied to clipboard")}catch(e){try{let e=document.createElement("textarea");e.value=l,e.style.position="fixed",e.style.opacity="0",document.body.appendChild(e),e.focus(),e.select(),document.execCommand("copy"),document.body.removeChild(e),s.oR.success("Copied to clipboard")}catch(e){s.oR.error("Failed to copy to clipboard")}}};return(0,n.jsx)("div",{className:"h-full w-full",children:(0,n.jsx)(R.A,{loading:!1,backgroundClickable:!1,onCancel:e.onCancel,cancelText:"Close",okDisabled:!w,onOk:A,okText:"Test",okButtonType:"primary",title:"Test Media",iconSvg:"",children:(0,n.jsxs)("div",{className:"h-[80vh] overflow-hidden",children:[(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsxs)(C.A,{type:"info",children:["Search for media items and validate them against the specified rule. The result will be a YAML document containing the validated steps.\n            ",(0,n.jsx)("br",{}),(0,n.jsx)("br",{}),"The rule group is of type ".concat(r.dataType===M.R.MOVIES?"movies":r.dataType===M.R.SEASONS?"seasons":r.dataType===M.R.EPISODES?"episodes":"series",", as a result only media of type ").concat(r.dataType===M.R.MOVIES?"movies":"series"," will be displayed in the search bar.")]})}),(0,n.jsx)(H.A,{label:"Media",children:(0,n.jsx)(F,{mediatype:r.dataType,libraryId:r.libraryId,onChange:e=>{(e=>{d(e),N(-1),p([P]),(null==e?void 0:e.type)==M.R.SHOWS&&(0,i.Ay)("/plex/meta/".concat(e.id,"/children")).then(e=>{p([P,...e.map(e=>({id:e.ratingKey,title:e.title}))])})})(e)}})}),(0,n.jsxs)("div",{className:"w-full",children:[r.dataType===M.R.SEASONS||r.dataType===M.R.EPISODES?(0,n.jsx)(H.A,{label:"Season",children:(0,n.jsx)("select",{name:"Seasons-field",id:"Seasons-field",value:u,onChange:e=>{N(+e.target.value)},children:f.map(e=>(0,n.jsx)("option",{value:e.id,children:e.title},e.id))})}):void 0,r.dataType===M.R.EPISODES?(0,n.jsx)(H.A,{label:"Episode",children:(0,n.jsx)("select",{name:"episode-field",id:"episode-field",value:x,onChange:e=>{h(+e.target.value)},children:b.map(e=>(0,n.jsx)("option",{value:e.id,children:e.title},e.id))})}):void 0]}),(0,n.jsxs)("div",{className:"mb-2 flex justify-between",children:[(0,n.jsx)("label",{htmlFor:"editor-field",className:"text-label",children:"Output"}),j&&(0,n.jsx)("button",{onClick:k,title:"Copy to clipboard","aria-label":"Copy to clipboard",children:(0,n.jsx)(L.A,{className:"h-5 w-5 text-amber-600 hover:text-amber-500"})})]}),(0,n.jsx)("div",{className:"editor-container h-full",children:(0,n.jsx)(S.KE,{options:{readOnly:!0,minimap:{enabled:!1}},defaultLanguage:"yaml",theme:"vs-dark",value:j?E.Ay.stringify(j.result):"",onMount:function(e,t){y.current=e}})})]})})})},B=e=>{var t;let[l,r]=(0,a.useState)([]),[s,c]=(0,a.useState)([]),[o,u]=(0,a.useState)("media"),[x,f]=(0,a.useState)(!1),g=(0,a.useRef)(0),[j,v]=(0,a.useState)(999),y=(0,a.useRef)(999),w=(0,a.useRef)([]),N=(0,a.useRef)([]),S=(0,a.useRef)(!0),E=(0,a.useRef)(!1),[A,C]=(0,a.useState)(0),T=()=>{!(window.innerHeight+document.documentElement.scrollTop>=.9*document.documentElement.scrollHeight)||S.current||E.current||25*(g.current-1)>=y.current||C(g.current+1)};(0,a.useEffect)(()=>{0!==A&&(g.current=g.current+1,R())},[A]),(0,a.useEffect)(()=>{let e=m().debounce(T,200);return window.addEventListener("scroll",e),()=>{window.removeEventListener("scroll",e),e.cancel()}},[]),(0,a.useEffect)(()=>{C(1)},[]);let R=async()=>{S.current||(E.current=!0);let t=await (0,i.Ay)("/collections/media/".concat(e.collection.id,"/content/").concat(g.current,"?size=").concat(25));v(t.totalSize),c([...N.current,...t.items]),r([...w.current,...t.items.map(e=>(e.plexData.maintainerrIsManual=!!e.isManual&&e.isManual,e.plexData?e.plexData:{}))]),S.current=!1,E.current=!1};return(0,a.useEffect)(()=>{w.current=l,S.current||E.current||!(window.innerHeight+document.documentElement.scrollTop>=.9*document.documentElement.scrollHeight)||25*(g.current-1)>=y.current||C(A+1)},[l]),(0,a.useEffect)(()=>{N.current=s},[s]),(0,a.useEffect)(()=>{y.current=j},[j]),(0,a.useEffect)(()=>(h().beforePopState(()=>(e.onBack(),window.history.forward(),!1)),()=>{h().beforePopState(()=>!0)}),[]),(0,n.jsxs)("div",{className:"w-full",children:[(0,n.jsx)("div",{className:"m-auto mb-3 flex w-full",children:(0,n.jsx)("h1",{className:"flex w-full justify-center overflow-hidden overflow-ellipsis whitespace-nowrap text-lg font-bold text-zinc-200 sm:m-0 sm:justify-start xl:m-0",children:"".concat(e.title)})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,n.jsx)("div",{className:"mb-4 mt-0 w-fit sm:w-full",children:(0,n.jsx)(p,{onChange:e=>u(e),routes:[{text:"Media",route:"media"},{text:"Exclusions",route:"exclusions"},{text:"Info",route:"info"}],currentRoute:o,allEnabled:!0})})}),(0,n.jsx)("div",{className:"flex justify-center sm:justify-start",children:(0,n.jsxs)("button",{className:"edit-button mb-4 flex h-9 rounded text-zinc-200 shadow-md",onClick:()=>f(!0),children:[(0,n.jsx)(d.A,{className:"m-auto ml-5 h-5"})," ",(0,n.jsx)("p",{className:"rules-button-text m-auto ml-1 mr-5",children:"Test Media"})]})}),"media"===o?(0,n.jsx)(b.A,{dataFinished:!0,fetchData:()=>{},loading:S.current,data:l,libraryId:e.libraryId,collectionPage:!0,extrasLoading:E&&!S.current&&j>=25*g.current,onRemove:e=>setTimeout(()=>{r(w.current.filter(t=>+t.ratingKey!=+e)),c(N.current.filter(t=>+t.plexId!=+e))},500),collectionInfo:s.map(t=>(e.collection.media=[],t.collection=e.collection,t))}):"exclusions"===o?(0,n.jsx)(z,{collection:e.collection,libraryId:e.libraryId}):"info"===o?(0,n.jsx)(D,{collection:e.collection}):void 0]}),x&&(null==(t=e.collection)?void 0:t.id)?(0,n.jsx)(V,{collectionId:+e.collection.id,onCancel:()=>{f(!1)},onSubmit:()=>{}}):void 0]})};var K=l(37408),U=l(98587),W=l(91710),X=l(54587),G=l.n(X);let Y=e=>{var t,l;let r=(0,a.useContext)(c.A);return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("a",{className:"hover:cursor-pointer",...e.onClick?{onClick:()=>e.onClick(e.collection)}:{},children:[e.collection.media&&e.collection.media.length>1?(0,n.jsxs)("div",{className:"absolute inset-0 z-[-100] flex flex-row overflow-hidden",children:[(0,n.jsx)(G(),{className:"backdrop-image",width:"600",height:"800",src:"https://image.tmdb.org/t/p/w500".concat(e.collection.media[0].image_path),alt:"img"}),(0,n.jsx)(G(),{className:"backdrop-image",width:"600",height:"800",src:"https://image.tmdb.org/t/p/w500/".concat(e.collection.media[1].image_path),alt:"img"}),(0,n.jsx)("div",{className:"collection-backdrop"})]}):void 0,(0,n.jsxs)("div",{className:"inset-0 z-0 h-fit p-3",children:[(0,n.jsx)("div",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap text-base font-bold text-white sm:text-lg",children:(0,n.jsx)("div",{children:e.collection.manualCollection?"".concat(e.collection.manualCollectionName," (manual)"):e.collection.title})}),(0,n.jsx)("div",{className:"h-12 max-h-12 overflow-y-hidden whitespace-normal text-base text-zinc-400 hover:overflow-y-scroll",children:e.collection.manualCollection?"Handled by rule: '".concat(e.collection.title,"'"):e.collection.description})]}),(0,n.jsxs)("div",{className:"inset-0 z-0 flex h-fit flex-row p-3 text-base sm:flex-row",children:[(0,n.jsxs)("div",{className:"mr-5 flex flex-row sm:mr-0 sm:mt-auto sm:flex-col",children:[(0,n.jsxs)("div",{className:"mb-5 mr-5 sm:mr-0",children:[(0,n.jsx)("p",{className:"font-bold",children:"Library"}),(0,n.jsx)("p",{className:"text-amber-500",children:null!=(l=null==(t=r.libraries.find(t=>+t.key==+e.collection.libraryId))?void 0:t.title)?l:(0,n.jsx)(n.Fragment,{children:"\xa0"})})]}),(0,n.jsxs)("div",{className:"mr-5 sm:mr-0",children:[(0,n.jsx)("p",{className:"font-bold",children:"Items"}),(0,n.jsxs)("p",{className:"text-amber-500",children:[" ","".concat(e.collection.media?e.collection.media.length:0)]})]})]}),(0,n.jsxs)("div",{className:"ml-auto flex flex-row text-right sm:mt-auto sm:flex-col",children:[(0,n.jsxs)("div",{className:"mb-5 mr-5 sm:mr-0",children:[(0,n.jsx)("p",{className:"font-bold",children:"Status"}),(0,n.jsx)("p",{children:e.collection.isActive?(0,n.jsx)("span",{className:"text-green-500",children:"Active"}):(0,n.jsx)("span",{className:"text-red-500",children:"Inactive"})})]}),(0,n.jsxs)("div",{className:"mr-0 sm:mr-0",children:[(0,n.jsx)("p",{className:"font-bold",children:"Delete"}),(0,n.jsx)("p",{className:"text-amber-500",children:null==e.collection.deleteAfterDays?"Never":"After ".concat(e.collection.deleteAfterDays," days")})]})]})]})]})})},q=e=>{var t;let{collectionHandlerRunning:l}=(0,K.oy)();return(0,n.jsxs)("div",{children:[(0,n.jsx)(W.A,{onSwitch:e.onSwitchLibrary}),(0,n.jsx)("div",{className:"m-auto mb-3 flex",children:(0,n.jsx)("div",{className:"m-auto sm:m-0",children:(0,n.jsx)(U.A,{onClick:e.doActions,text:"Handle Collections",executing:l,disabled:l})})}),(0,n.jsxs)("div",{className:"w-full",children:[(0,n.jsx)("div",{className:"m-auto mb-3 flex",children:(0,n.jsx)("h1",{className:"m-auto text-lg font-bold text-zinc-200 sm:m-0 xl:m-0",children:"Automatic collections"})}),(0,n.jsx)("ul",{className:"xs:collection-cards-vertical",children:null==(t=e.collections)?void 0:t.map(t=>(0,n.jsx)("li",{className:"collection relative mb-5 flex h-fit transform-gpu flex-col overflow-hidden rounded-xl bg-zinc-800 bg-cover bg-center p-4 text-zinc-400 shadow ring-1 ring-zinc-700 xs:w-full sm:mb-0 sm:mr-5",children:(0,n.jsx)(Y,{collection:t,onClick:()=>e.openDetail(t)},t.id)},+t.id))})]})]})},J=()=>{let e=(0,a.useContext)(c.A),[t,l]=(0,a.useState)(!0),[d,u]=(0,a.useState)({open:!1,collection:void 0}),[m,x]=(0,a.useState)(),[h,f]=(0,a.useState)();(0,a.useEffect)(()=>{document.title="Maintainerr - Collections"},[]),(0,a.useEffect)(()=>{p()},[m]);let p=async()=>{f(m?await (0,i.Ay)("/collections?libraryId=".concat(m.key)):await (0,i.Ay)("/collections")),l(!1)},b=async()=>{try{await (0,i.vI)("/collections/handle",{}),s.oR.success("Initiated collection handling in the background.")}catch(t){if(t instanceof r.pe){var e;if((null==(e=t.response)?void 0:e.status)===409)return void s.oR.error("Collection handling is already running.")}s.oR.error("Failed to initiate collection handling.")}};return t?(0,n.jsx)(o.A,{}):(0,n.jsx)("div",{className:"w-full",children:d.open?(0,n.jsx)(B,{libraryId:d.collection?d.collection.libraryId:0,title:d.collection?d.collection.title:"",collection:d.collection,onBack:()=>{l(!0),u({open:!1,collection:void 0}),p(),l(!1)}}):(0,n.jsx)(q,{onSwitchLibrary:t=>{x(9999!=t?e.libraries.find(e=>+e.key===t):void 0)},collections:h,doActions:b,openDetail:e=>{u({open:!0,collection:e})}})})},Q=()=>(0,n.jsx)(J,{})},98587:(e,t,l)=>{"use strict";l.d(t,{A:()=>s});var n=l(37876),r=l(77834),a=l(10291);let s=e=>(0,n.jsxs)("button",{className:"edit-button m-auto flex h-9 rounded text-zinc-200 shadow-md",onClick:e.onClick,disabled:e.disabled,children:[e.executing?(0,n.jsx)(a.r,{className:"m-auto ml-2 h-5"}):(0,n.jsx)(r.A,{className:"m-auto ml-4 h-5"})," ",(0,n.jsx)("p",{className:"rules-button-text m-auto ml-1 mr-4",children:e.text})]})}},e=>{e.O(0,[888,488,16,397,636,593,792],()=>e(e.s=14785)),_N_E=e.O()}]);